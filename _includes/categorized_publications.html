<!-- Research Categories Section with macOS-style Windows -->

<div class="research-categories-section">
  <h2 style="margin: 2px 0px 20px;">Research Publications</h2>
  <p style="color: #666; margin-bottom: 30px; font-size: 0.95rem;">
    Click on each category to explore publications. <span style="color: blue;"><a href="https://scholar.google.com/citations?user=9R3tsmUAAAAJ&hl=en" target="_blank">[Google Scholar]</a></span>
  </p>
  
  <!-- Category Icons Grid -->
  <div class="category-grid four-categories">
    {% for category in site.data.publications %}
      {% if category[0] != 'main' and category[0] != 'other' %}
        {% assign cat_key = category[0] %}
        {% assign cat_data = category[1] %}
        <div class="category-icon-wrapper" onclick="openMacWindow('{{ cat_key }}')">
          <div class="category-icon" style="--category-color: {{ cat_data.color }}">
            <div class="icon-bg" style="background: linear-gradient(135deg, {{ cat_data.color }}20, {{ cat_data.color }}40);">
              <i class="fas {{ cat_data.icon }}" style="color: {{ cat_data.color }};"></i>
            </div>
            <div class="icon-glow" style="background: {{ cat_data.color }};"></div>
          </div>
          <div class="category-label">{{ cat_data.title }}</div>
          <div class="category-count">{{ cat_data.papers.size }} papers</div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<!-- macOS Style Windows (Hidden by default) -->
<div id="mac-window-overlay" class="mac-window-overlay" onclick="closeAllWindows(event)">
  {% for category in site.data.publications %}
    {% if category[0] != 'main' and category[0] != 'other' %}
      {% assign cat_key = category[0] %}
      {% assign cat_data = category[1] %}
      
      <div id="mac-window-{{ cat_key }}" class="mac-window" data-category="{{ cat_key }}">
        <!-- macOS Window Title Bar -->
        <div class="mac-window-titlebar" style="background: linear-gradient(135deg, {{ cat_data.color }}15, {{ cat_data.color }}05);">
          <div class="mac-window-controls">
            <div class="mac-btn mac-btn-close" onclick="closeMacWindow('{{ cat_key }}')">
              <i class="fas fa-times"></i>
            </div>
            <div class="mac-btn mac-btn-minimize" onclick="minimizeMacWindow('{{ cat_key }}')">
              <i class="fas fa-minus"></i>
            </div>
            <div class="mac-btn mac-btn-expand" onclick="expandMacWindow('{{ cat_key }}')">
              <i class="fas fa-expand"></i>
            </div>
          </div>
          <div class="mac-window-title">
            <i class="fas {{ cat_data.icon }}" style="color: {{ cat_data.color }}; margin-right: 8px;"></i>
            {{ cat_data.title }}
          </div>
          <div class="mac-window-spacer"></div>
        </div>
        
        <!-- macOS Window Content -->
        <div class="mac-window-content">
          <div class="category-description" style="border-left-color: {{ cat_data.color }};">
            <i class="fas {{ cat_data.icon }}" style="color: {{ cat_data.color }};"></i>
            <p>{{ cat_data.description }}</p>
          </div>
          
          <div class="papers-list">
            {% for paper in cat_data.papers %}
              <div class="paper-card" style="--paper-accent: {{ cat_data.color }}">
                <div class="paper-image">
                  {% if paper.image %}
                    <img src="{{ paper.image }}" alt="{{ paper.title }}" />
                    {% if paper.conference_short %}
                      <span class="paper-badge">{{ paper.conference_short }}</span>
                    {% endif %}
                  {% endif %}
                </div>
                <div class="paper-info">
                  <div class="paper-title">
                    {% if paper.pdf %}
                      <a href="{{ paper.pdf }}" target="_blank">{{ paper.title }}</a>
                    {% else %}
                      {{ paper.title }}
                    {% endif %}
                  </div>
                  <div class="paper-authors">{{ paper.authors }}</div>
                  <div class="paper-conference">
                    <em>{{ paper.conference }}</em>
                  </div>
                  <div class="paper-links">
                    {% if paper.pdf %}
                      <a href="{{ paper.pdf }}" class="paper-btn" target="_blank">
                        <i class="fas fa-file-pdf"></i> PDF
                      </a>
                    {% endif %}
                    {% if paper.code %}
                      <a href="{{ paper.code }}" class="paper-btn" target="_blank">
                        <i class="fab fa-github"></i> Code
                      </a>
                    {% endif %}
                    {% if paper.page %}
                      <a href="{{ paper.page }}" class="paper-btn" target="_blank">
                        <i class="fas fa-globe"></i> Project
                      </a>
                    {% endif %}
                    {% if paper.bibtex %}
                      <a href="{{ paper.bibtex }}" class="paper-btn" target="_blank">
                        <i class="fas fa-quote-right"></i> BibTeX
                      </a>
                    {% endif %}
                  </div>
                  {% if paper.notes %}
                    <div class="paper-notes">
                      <i class="fas fa-star"></i> {{ paper.notes }}
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<!-- App Launch Animation Overlay -->
<div id="app-launch-overlay" class="app-launch-overlay">
  <div class="app-launch-icon">
    <i class="fas fa-layer-group"></i>
  </div>
  <div class="app-launch-text">Opening...</div>
</div>

<style>
/* Category Grid Styles */
.research-categories-section {
  margin: 30px 0;
}

.category-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 30px;
  margin-top: 20px;
}

.category-grid.four-categories {
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

@media (max-width: 900px) {
  .category-grid.four-categories {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .category-grid.four-categories {
    grid-template-columns: 1fr;
  }
}

.category-icon-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  padding: 20px 15px;
  border-radius: 20px;
  background: linear-gradient(145deg, #f8f9fa, #e9ecef);
  box-shadow: 8px 8px 16px #d1d5db, -8px -8px 16px #ffffff;
}

.category-icon-wrapper:hover {
  transform: translateY(-5px) scale(1.02);
}

.category-icon {
  position: relative;
  width: 70px;
  height: 70px;
  margin-bottom: 12px;
}

.icon-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  z-index: 2;
}

.category-icon-wrapper:hover .icon-bg {
  transform: scale(1.1);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.icon-glow {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  filter: blur(20px);
  opacity: 0.4;
  z-index: 1;
  transition: opacity 0.3s ease;
}

.category-icon-wrapper:hover .icon-glow {
  opacity: 0.7;
}

.category-label {
  font-size: 0.9rem;
  font-weight: 600;
  color: #333;
  text-align: center;
  margin-bottom: 4px;
  line-height: 1.3;
}

.category-count {
  font-size: 0.75rem;
  color: #888;
}

/* macOS Window Styles */
.mac-window-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(8px);
  z-index: 1000;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow-y: auto;
  padding: 40px 20px;
}

.mac-window-overlay.active {
  display: block;
  opacity: 1;
}

.mac-window {
  position: relative;
  max-width: 900px;
  margin: 0 auto;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 16px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  overflow: hidden;
  transform: scale(0.8) translateY(50px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: none;
}

.mac-window.active {
  display: block;
  transform: scale(1) translateY(0);
  opacity: 1;
}

.mac-window.minimized {
  transform: scale(0.1) translateY(500px);
  opacity: 0;
}

.mac-window.expanded {
  max-width: 95%;
  width: 95%;
  min-height: 80vh;
}

/* macOS Title Bar */
.mac-window-titlebar {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
}

.mac-window-controls {
  display: flex;
  gap: 8px;
}

.mac-btn {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 8px;
  color: transparent;
  transition: all 0.2s ease;
}

.mac-btn:hover {
  color: rgba(0, 0, 0, 0.5);
}

.mac-btn-close {
  background: #ff5f57;
}

.mac-btn-minimize {
  background: #febc2e;
}

.mac-btn-expand {
  background: #28c840;
}

.mac-window-title {
  flex: 1;
  text-align: center;
  font-weight: 600;
  font-size: 0.95rem;
  color: #333;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mac-window-spacer {
  width: 60px;
}

/* Window Content */
.mac-window-content {
  padding: 24px;
  max-height: 70vh;
  overflow-y: auto;
}

.category-description {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 16px 20px;
  background: #f8f9fa;
  border-radius: 12px;
  margin-bottom: 24px;
  border-left: 4px solid;
}

.category-description i {
  font-size: 1.5rem;
  margin-top: 2px;
}

.category-description p {
  margin: 0;
  color: #666;
  font-size: 0.95rem;
  line-height: 1.6;
}

/* Paper Cards */
.papers-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.paper-card {
  display: flex;
  gap: 20px;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.06);
  transition: all 0.3s ease;
}

.paper-card:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border-left: 3px solid var(--paper-accent);
}

.paper-image {
  flex-shrink: 0;
  width: 140px;
  height: 100px;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
  background: #f0f0f0;
}

.paper-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.paper-badge {
  position: absolute;
  top: 8px;
  left: 8px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
}

.paper-info {
  flex: 1;
}

.paper-title {
  font-size: 1.05rem;
  font-weight: 600;
  margin-bottom: 8px;
  line-height: 1.4;
}

.paper-title a {
  color: #333;
  text-decoration: none;
  transition: color 0.2s;
}

.paper-title a:hover {
  color: #6699cc;
}

.paper-authors {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 6px;
}

.paper-conference {
  font-size: 0.9rem;
  color: #888;
  margin-bottom: 12px;
}

.paper-links {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.paper-btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 12px;
  background: #f0f0f0;
  border-radius: 6px;
  font-size: 0.8rem;
  color: #555;
  text-decoration: none;
  transition: all 0.2s;
}

.paper-btn:hover {
  background: #e0e0e0;
  color: #333;
}

.paper-notes {
  margin-top: 10px;
  padding: 8px 12px;
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  border-radius: 6px;
  font-size: 0.85rem;
  color: #92400e;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.paper-notes i {
  color: #f59e0b;
}

/* App Launch Animation */
.app-launch-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.app-launch-overlay.active {
  display: flex;
  opacity: 1;
}

.app-launch-icon {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: white;
  box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
  animation: appBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes appBounce {
  0% {
    transform: scale(0.3);
    opacity: 0;
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.app-launch-text {
  margin-top: 20px;
  font-size: 1.2rem;
  color: #666;
  font-weight: 500;
  animation: textFadeIn 0.4s ease 0.3s both;
}

@keyframes textFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  .category-icon-wrapper {
    background: linear-gradient(145deg, #2d3748, #1a202c);
    box-shadow: 8px 8px 16px #1a202c, -8px -8px 16px #3d4856;
  }
  
  .category-label {
    color: #e2e8f0;
  }
  
  .mac-window {
    background: rgba(30, 30, 30, 0.95);
  }
  
  .mac-window-title {
    color: #e2e8f0;
  }
  
  .category-description {
    background: #2d3748;
  }
  
  .category-description p {
    color: #a0aec0;
  }
  
  .paper-card {
    background: #2d3748;
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .paper-title a {
    color: #e2e8f0;
  }
  
  .paper-title a:hover {
    color: #63b3ed;
  }
  
  .paper-authors {
    color: #a0aec0;
  }
  
  .paper-conference {
    color: #718096;
  }
  
  .paper-btn {
    background: #4a5568;
    color: #e2e8f0;
  }
  
  .paper-btn:hover {
    background: #4a5568;
    color: #fff;
  }
  
  .app-launch-overlay {
    background: rgba(26, 32, 44, 0.95);
  }
  
  .app-launch-text {
    color: #a0aec0;
  }
}

/* Scrollbar Styling */
.mac-window-content::-webkit-scrollbar {
  width: 8px;
}

.mac-window-content::-webkit-scrollbar-track {
  background: transparent;
}

.mac-window-content::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
}

.mac-window-content::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
  .category-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
  
  .mac-window {
    max-width: 95%;
    margin: 20px auto;
  }
  
  .paper-card {
    flex-direction: column;
  }
  
  .paper-image {
    width: 100%;
    height: 150px;
  }
  
  .mac-window-content {
    padding: 16px;
  }
}
</style>

<script>
// macOS Window Management
let currentOpenWindow = null;
let isExpanded = false;

function openMacWindow(category) {
  // Show app launch animation
  const launchOverlay = document.getElementById('app-launch-overlay');
  launchOverlay.classList.add('active');
  
  // Get category color for launch icon
  const categoryData = {
    'federated_tsfm': { icon: 'fa-network-wired', color: '#3b82f6' },
    'ai4science': { icon: 'fa-flask', color: '#10b981' },
    'remote_sensing': { icon: 'fa-satellite', color: '#f59e0b' },
    'medical_imaging': { icon: 'fa-heart-pulse', color: '#ef4444' }
  };
  
  const launchIcon = launchOverlay.querySelector('.app-launch-icon');
  const launchText = launchOverlay.querySelector('.app-launch-text');
  
  if (categoryData[category]) {
    launchIcon.style.background = `linear-gradient(135deg, ${categoryData[category].color}88, ${categoryData[category].color})`;
    launchIcon.innerHTML = `<i class="fas ${categoryData[category].icon}"></i>`;
    launchText.textContent = `Opening ${category.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}...`;
  }
  
  // After animation, show window
  setTimeout(() => {
    launchOverlay.classList.remove('active');
    
    const overlay = document.getElementById('mac-window-overlay');
    const window = document.getElementById(`mac-window-${category}`);
    
    overlay.classList.add('active');
    
    // Close any previously open window
    if (currentOpenWindow && currentOpenWindow !== window) {
      currentOpenWindow.classList.remove('active');
    }
    
    // Small delay for smooth animation
    setTimeout(() => {
      window.classList.add('active');
      currentOpenWindow = window;
      isExpanded = false;
    }, 50);
  }, 800);
}

function closeMacWindow(category) {
  const window = document.getElementById(`mac-window-${category}`);
  const overlay = document.getElementById('mac-window-overlay');
  
  window.classList.remove('active', 'expanded');
  isExpanded = false;
  
  setTimeout(() => {
    if (!document.querySelector('.mac-window.active')) {
      overlay.classList.remove('active');
    }
    currentOpenWindow = null;
  }, 300);
}

function closeAllWindows(event) {
  if (event.target === event.currentTarget) {
    const overlay = document.getElementById('mac-window-overlay');
    const windows = document.querySelectorAll('.mac-window');
    
    windows.forEach(window => {
      window.classList.remove('active', 'expanded');
    });
    
    isExpanded = false;
    
    setTimeout(() => {
      overlay.classList.remove('active');
      currentOpenWindow = null;
    }, 300);
  }
}

function minimizeMacWindow(category) {
  const window = document.getElementById(`mac-window-${category}`);
  window.classList.add('minimized');
  
  setTimeout(() => {
    window.classList.remove('active', 'minimized');
    if (!document.querySelector('.mac-window.active')) {
      document.getElementById('mac-window-overlay').classList.remove('active');
      currentOpenWindow = null;
    }
  }, 400);
}

function expandMacWindow(category) {
  const window = document.getElementById(`mac-window-${category}`);
  isExpanded = !isExpanded;
  
  if (isExpanded) {
    window.classList.add('expanded');
  } else {
    window.classList.remove('expanded');
  }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const overlay = document.getElementById('mac-window-overlay');
    if (overlay.classList.contains('active')) {
      const windows = document.querySelectorAll('.mac-window');
      windows.forEach(window => {
        window.classList.remove('active', 'expanded');
      });
      overlay.classList.remove('active');
      currentOpenWindow = null;
      isExpanded = false;
    }
  }
});
</script>
